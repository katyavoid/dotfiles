#!/usr/bin/env python

import re
import os
import subprocess


def bundle_path(bundle_dir):
    return os.path.join(os.path.expanduser('~/.vim/bundle'),
                        bundle_dir.split('/')[-1].replace('\n', ''))


def install_or_update():
    with open(os.path.expanduser('~/.vim/bundles.txt'), 'r') as bundles_file:
        for bundle in bundles_file:
            if not (re.match('^\n', bundle) or re.match('^#', bundle)):
                if os.path.exists(bundle_path(bundle.replace('.git', ''))):
                    os.chdir(bundle_path(bundle.replace('.git', '')))
                    print("Updating {0}".format(bundle))
                    subprocess.check_call(['git', 'pull', 'origin', 'master'])
                else:
                    print("Installing {0}".format(bundle))
                    subprocess.check_call(
                        [
                            'git',
                            'clone',
                            bundle.replace('\n', ''),
                            bundle_path(bundle.replace('.git', ''))
                        ])


if __name__ == '__main__':
    install_or_update()
